//
//  DRTakingMovieNoteViewController.m
//  CaiJinTongApp
//
//  Created by apple on 13-11-15.
//  Copyright (c) 2013年 david. All rights reserved.
//

#import "DRTakingMovieNoteViewController.h"

@implementation DRTakingMovieNoteViewController

- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil
{
    self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil];
    if (self) {
        // Custom initialization
    }
    return self;
}


-(void)keyBoardWillHide:(id)sender{
    CGRect selfRect = self.view.frame;
    self.view.frame = (CGRect){selfRect.origin.x,140,selfRect.size};
}

-(void)keyBoardWillShow:(id)sender{
    CGRect selfRect = self.view.frame;
    self.view.frame = (CGRect){selfRect.origin.x,30,selfRect.size};
}

-(void)popouViewFinishedFrameRect:(id)sender{
    [self.contentField becomeFirstResponder];
}

- (void)viewDidLoad
{
    [super viewDidLoad];
    
    self.noteTimeLabel.text = [Utility getNowDateFromatAnDate];
    
    UIImage *btnImageHighlighted = [[UIImage imageNamed:@"btn0.png"] resizableImageWithCapInsets:UIEdgeInsetsMake(6, 6, 6, 6) resizingMode:UIImageResizingModeStretch];
    UIImage *btnImageNormal = [[UIImage imageNamed:@"btn1.png"] resizableImageWithCapInsets:UIEdgeInsetsMake(6, 6, 6, 6) resizingMode:UIImageResizingModeStretch];
    [self.cancelBtn setBackgroundImage:btnImageNormal forState:UIControlStateNormal];
    [self.cancelBtn setBackgroundImage:btnImageHighlighted forState:UIControlStateHighlighted];
    [self.commitBtn setBackgroundImage:btnImageNormal forState:UIControlStateNormal];
    [self.commitBtn setBackgroundImage:btnImageHighlighted forState:UIControlStateHighlighted];
    
    self.contentField.layer.borderColor = [UIColor grayColor].CGColor;
    self.contentField.layer.borderWidth =1.0;
    self.contentField.layer.cornerRadius =5.0;
    [self.view.layer setCornerRadius:6];
    [self.view.layer setMasksToBounds:YES];
    
}

- (void)didReceiveMemoryWarning
{
    [super didReceiveMemoryWarning];
}

- (IBAction)spaceAreaClicked:(id)sender {
    [self.contentField resignFirstResponder];
}

- (IBAction)cancelBtnClicked:(UIButton *)sender {
    [self dismissPopupViewControllerWithanimationType:MJPopupViewAnimationSlideTopTop];
    if (self.delegate && [self.delegate respondsToSelector:@selector(takingMovieNoteControllerCancel)]) {
        [self.delegate takingMovieNoteControllerCancel];
    }
}

- (IBAction)commitBtnClicked:(UIButton *)sender {
    if (self.contentField.text == nil || [[self.contentField.text stringByTrimmingCharactersInSet:[NSCharacterSet whitespaceAndNewlineCharacterSet]] isEqualToString:@""]) {
        [Utility errorAlert:@"内容不能为空"];
    }else {
        if (self.contentField.text.length > 500) {
            [Utility errorAlert:@"字数不能超过500"];
            return;
        }
        
        [self dismissPopupViewControllerWithanimationType:MJPopupViewAnimationSlideTopTop];
        if (self.delegate && [self.delegate respondsToSelector:@selector(takingMovieNoteController:commitNote: andTime:)]) {
            [self.delegate takingMovieNoteController:self commitNote:self.contentField.text andTime:self.noteTimeLabel.text];
        }
    }
}



@end